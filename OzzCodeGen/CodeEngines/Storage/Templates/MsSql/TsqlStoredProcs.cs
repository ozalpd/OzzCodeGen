// ------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version: 14.0.0.0
//  
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace OzzCodeGen.CodeEngines.Storage.Templates.MsSql
{
    using System.Linq;
    using System.Text;
    using System.Collections.Generic;
    using System;
    
    /// <summary>
    /// Class to produce the template output
    /// </summary>
    
    #line 1 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "14.0.0.0")]
    public partial class TsqlStoredProcs : AbstractStorageTemplate
    {
#line hidden
        /// <summary>
        /// Create the template output
        /// </summary>
        public override string TransformText()
        {
            this.Write("SET ANSI_NULLS ON\r\nGO\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\n\r\n");
            
            #line 12 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  var firstBase = TableDefinition.GetFirstBase();
	string pkeyVal = "@" + firstBase.PrimaryKeyColumn.Name;
	var deleteMarkColumn = firstBase.GetDeleteMarkColumn();
	bool createInsertOrUpdate = true;

            
            #line default
            #line hidden
            this.Write("-- --------------------------------------------------------------------\r\n-- Store" +
                    "d Procedure: [");
            
            #line 18 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 18 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Delete]\r\n-- --------------------------------------------------------------------" +
                    "\r\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N\'[");
            
            #line 20 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 20 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Delete]\') AND type in (N\'P\', N\'PC\'))\r\nDROP PROCEDURE [");
            
            #line 21 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 21 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Delete]\r\nGO\r\nCREATE PROCEDURE [");
            
            #line 23 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 23 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Delete]\r\n\t");
            
            #line 24 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 24 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(firstBase.PrimaryKeyColumn)));
            
            #line default
            #line hidden
            this.Write("\r\nAs\r\nBegin\r\n");
            
            #line 27 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"

if(deleteMarkColumn != null)
{
 
            
            #line default
            #line hidden
            this.Write("    Declare @");
            
            #line 31 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(deleteMarkColumn.Name));
            
            #line default
            #line hidden
            this.Write(" bit\r\n\r\n\tSelect @");
            
            #line 33 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(deleteMarkColumn.Name));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 33 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(deleteMarkColumn.Name));
            
            #line default
            #line hidden
            this.Write("\r\n\t\tFrom [");
            
            #line 34 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 34 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.TableName));
            
            #line default
            #line hidden
            this.Write("]\r\n\t\tWhere ");
            
            #line 35 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 35 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write("\r\n\r\n\tIf @");
            
            #line 37 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(deleteMarkColumn.Name));
            
            #line default
            #line hidden
            this.Write(" = 1\r\n\tBegin\r\n\t\t/* TODO: Check cascaded data from other tables */\r\n");
            
            #line 40 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  PushIndent("    ");
	WriteDeleteStatement(TableDefinition, firstBase, pkeyVal);
	PopIndent(); 
            
            #line default
            #line hidden
            this.Write("\t\t\r\n\tEnd\r\n\tElse\r\n\tBegin\r\n\t\tUpdate [");
            
            #line 47 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 47 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.TableName));
            
            #line default
            #line hidden
            this.Write("]\r\n\t\t\tSet ");
            
            #line 48 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(deleteMarkColumn.Name));
            
            #line default
            #line hidden
            this.Write(" = 1\r\n\t\t\tWhere [");
            
            #line 49 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn));
            
            #line default
            #line hidden
            this.Write("] = ");
            
            #line 49 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write("\r\n\tEnd\r\n");
            
            #line 51 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} else { 
            
            #line default
            #line hidden
            this.Write("\t/* TODO: Check cascaded data from other tables */\r\n");
            
            #line 53 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteDeleteStatement(TableDefinition, firstBase, pkeyVal); 
            
            #line default
            #line hidden
            
            #line 54 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"

} 
            
            #line default
            #line hidden
            this.Write("End\r\nGo\r\n-- --------------------------------------------------------------------\r" +
                    "\n-- Stored Procedure: [");
            
            #line 59 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 59 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Insert]\r\n-- --------------------------------------------------------------------" +
                    "\r\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N\'[");
            
            #line 61 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 61 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Insert]\') AND type in (N\'P\', N\'PC\'))\r\nDROP PROCEDURE [");
            
            #line 62 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 62 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Insert]\r\nGO\r\nCREATE PROCEDURE [");
            
            #line 64 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 64 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Insert]\r\n");
            
            #line 65 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
		
	var colDeclaresIns = TableDefinition.GetColumnList().Where(c => c.PrimaryKey == false && !c.DataType.StartsWith("as ", StringComparison.InvariantCultureIgnoreCase) && c.Exclude == false & string.IsNullOrEmpty(c.InsertDefault));
	int colNr = 0;
	foreach (var column in colDeclaresIns)
	{ 
			colNr++;
            
            #line default
            #line hidden
            this.Write("\t@");
            
            #line 71 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 71 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(column)));
            
            #line default
            #line hidden
            
            #line 71 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(colNr < colDeclaresIns.Count()) {
            
            #line default
            #line hidden
            this.Write(",");
            
            #line 71 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  } 
            
            #line default
            #line hidden
            this.Write(" \r\n");
            
            #line 72 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("As\r\nBegin\r\n    Declare @newKey\t\t");
            
            #line 75 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.PrimaryKeyColumn.DataType));
            
            #line default
            #line hidden
            this.Write("\r\n\r\n");
            
            #line 77 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteInsertStatement(firstBase, string.Empty); 
            
            #line default
            #line hidden
            this.Write("\r\n\tSet @newKey = SCOPE_IDENTITY()\r\n");
            
            #line 80 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  if(TableDefinition.UseInheritance)
	{ 
            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 83 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteInsertStatement(TableDefinition, "@newKey"); 
            
            #line default
            #line hidden
            
            #line 84 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 86 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteSelectStatement("@newKey"); 
            
            #line default
            #line hidden
            this.Write("End\r\nGo\r\n-- --------------------------------------------------------------------\r" +
                    "\n-- Stored Procedure: [");
            
            #line 90 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 90 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Update]\r\n-- --------------------------------------------------------------------" +
                    "\r\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N\'[");
            
            #line 92 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 92 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Update]\') AND type in (N\'P\', N\'PC\'))\r\nDROP PROCEDURE [");
            
            #line 93 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 93 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Update]\r\nGO\r\n");
            
            #line 95 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
	var colDeclaresUpd = TableDefinition.GetColumnList().Where(c => c.PrimaryKey == false && c.Exclude == false && !c.DataType.StartsWith("as ", StringComparison.InvariantCultureIgnoreCase) & string.IsNullOrEmpty(c.UpdateDefault));

            
            #line default
            #line hidden
            this.Write("CREATE PROCEDURE [");
            
            #line 98 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 98 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_Update]\r\n\t");
            
            #line 99 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 99 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(firstBase.PrimaryKeyColumn)));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 100 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
		
	colNr = 0;
	foreach (var column in colDeclaresUpd)
	{ 
			colNr++;
            
            #line default
            #line hidden
            this.Write("\t@");
            
            #line 105 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 105 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(column)));
            
            #line default
            #line hidden
            
            #line 105 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(colNr < colDeclaresUpd.Count()) {
            
            #line default
            #line hidden
            this.Write(",");
            
            #line 105 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  } 
            
            #line default
            #line hidden
            this.Write(" \r\n");
            
            #line 106 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("As\r\nBegin\r\n\r\n");
            
            #line 110 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteUpdateStatement(TableDefinition, pkeyVal); 
            
            #line default
            #line hidden
            
            #line 111 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  if(TableDefinition.UseInheritance)
	{ 
            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 114 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteUpdateStatement(firstBase, pkeyVal); 
            
            #line default
            #line hidden
            
            #line 115 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 117 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteSelectStatement(pkeyVal); 
            
            #line default
            #line hidden
            this.Write("End\r\nGo\r\n\r\n-- -------------------------------------------------------------------" +
                    "-\r\n-- Stored Procedure: [");
            
            #line 122 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 122 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_InsertOrUpdate]\r\n-- ------------------------------------------------------------" +
                    "--------\r\n");
            
            #line 124 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(createInsertOrUpdate){ 
            
            #line default
            #line hidden
            this.Write("IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N\'[");
            
            #line 125 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 125 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_InsertOrUpdate]\') AND type in (N\'P\', N\'PC\'))\r\nDROP PROCEDURE [");
            
            #line 126 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 126 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_InsertOrUpdate]\r\nGO\r\nCREATE PROCEDURE [");
            
            #line 128 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 128 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_InsertOrUpdate]\r\n\t--");
            
            #line 129 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 129 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(firstBase.PrimaryKeyColumn)));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 130 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
		
	colNr = 0;
	foreach (var column in colDeclaresUpd)
	{ 
			colNr++;
            
            #line default
            #line hidden
            this.Write("\t@");
            
            #line 135 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 135 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(column)));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 136 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("\t@Result int OUTPUT\r\nAs\r\nBegin\r\n\tDeclare ");
            
            #line 140 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 140 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(GetColumnType(firstBase.PrimaryKeyColumn)));
            
            #line default
            #line hidden
            this.Write("\r\n\r\n\tSet @Result = 0\r\n\tSelect ");
            
            #line 143 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 143 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn.Name));
            
            #line default
            #line hidden
            this.Write("\r\n\t\tFrom [");
            
            #line 144 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));
            
            #line default
            #line hidden
            this.Write("].[");
            
            #line 144 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("]\r\n\t\tWhere ");
            
            #line 145 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn.Name));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 145 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write("\r\n\r\n\tIf @Id Is Null\r\n\tBegin\r\n\t\t");
            
            #line 149 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteInsertStatement(firstBase, string.Empty); 
            
            #line default
            #line hidden
            this.Write("\t\tSet @Result = 1\r\n\tEnd\r\n\r\n\tIf (Not ");
            
            #line 153 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pkeyVal));
            
            #line default
            #line hidden
            this.Write(" Is Null)\r\n\tBegin\r\n");
            
            #line 155 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteUpdateStatement(TableDefinition, pkeyVal); 
            
            #line default
            #line hidden
            
            #line 156 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  if(TableDefinition.UseInheritance)
	{ 
            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 159 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteUpdateStatement(firstBase, pkeyVal); 
            
            #line default
            #line hidden
            
            #line 160 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("\t\tSet @Result = -1\r\n\tEnd\r\n\tSelect @Result\r\nEnd\r\nGo\r\n/*\r\nTo map in EF\r\n\r\n        p" +
                    "ublic int InsertOrUpdate(");
            
            #line 169 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.EntityDefinition.Name));
            
            #line default
            #line hidden
            this.Write(" entity)\r\n        {\r\n            var result = ");
            
            #line 171 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));
            
            #line default
            #line hidden
            this.Write("_InsertOrUpdate(\r\n                //entity.");
            
            #line 172 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 173 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
		
	colNr = 0;
	foreach (var column in colDeclaresUpd)
	{ 
			colNr++;
            
            #line default
            #line hidden
            this.Write("\t\t\t\tentity.");
            
            #line 178 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 179 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            this.Write("                new ObjectParameter(\"Result\", typeof(int)));\r\n\r\n            retur" +
                    "n result.FirstOrDefault() ?? 0;\r\n        }\r\n\r\n*/\r\n");
            
            #line 186 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
            
            #line default
            #line hidden
            return this.GenerationEnvironment.ToString();
        }
        
        #line 187 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
protected void WriteDeleteStatement(StorageEntitySetting table, StorageEntitySetting baseTable,string pkeyValue)
{ 
        
        #line default
        #line hidden
        
        #line 189 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tDelete From [");

        
        #line default
        #line hidden
        
        #line 190 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.SchemaName));

        
        #line default
        #line hidden
        
        #line 190 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 190 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.TableName));

        
        #line default
        #line hidden
        
        #line 190 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]\r\n\t\tWhere [");

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.SchemaName));

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.TableName));

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] = ");

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(pkeyValue));

        
        #line default
        #line hidden
        
        #line 191 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\r\n");

        
        #line default
        #line hidden
        
        #line 192 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(TableDefinition.UseInheritance)
	{ 
        
        #line default
        #line hidden
        
        #line 193 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\r\n\tDelete From [");

        
        #line default
        #line hidden
        
        #line 195 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(baseTable.SchemaName));

        
        #line default
        #line hidden
        
        #line 195 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 195 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(baseTable.TableName));

        
        #line default
        #line hidden
        
        #line 195 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]\r\n\t\tWhere [");

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(baseTable.SchemaName));

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(baseTable.TableName));

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(baseTable.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] = ");

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(pkeyValue));

        
        #line default
        #line hidden
        
        #line 196 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\r\n");

        
        #line default
        #line hidden
        
        #line 197 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
        
        #line default
        #line hidden
        
        #line 198 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
} 
        
        #line default
        #line hidden
        
        #line 200 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
protected void WriteUpdateStatement(StorageEntitySetting table, string pkeyValue)
{
	var columns = table.UseInheritance ?
			table.Properties.Where(c => c.PrimaryKey == false & c.Exclude == false & c.UpdateDefault != "NeverUpdate") :
			table.GetColumnList().Where(c => c.PrimaryKey == false & c.Exclude == false & c.UpdateDefault != "NeverUpdate");
	if(columns.Any())
    {
 
        
        #line default
        #line hidden
        
        #line 208 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tUpdate [");

        
        #line default
        #line hidden
        
        #line 209 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.SchemaName));

        
        #line default
        #line hidden
        
        #line 209 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 209 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.TableName));

        
        #line default
        #line hidden
        
        #line 209 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]\r\n\t\tSet ");

        
        #line default
        #line hidden
        
        #line 210 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	
	int colNr = 0;
	PushIndent("            ");
	foreach (var column in columns)
	{ 
		if(colNr != 0 & (colNr % 2 == 0)) { WriteLine(""); } 
		colNr++;
		string colValue = string.IsNullOrEmpty(column.UpdateDefault) ? "@" + column.Name : column.UpdateDefault.Replace("{TableName}", table.TableName);
		
        
        #line default
        #line hidden
        
        #line 218 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("[");

        
        #line default
        #line hidden
        
        #line 219 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));

        
        #line default
        #line hidden
        
        #line 219 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] = ");

        
        #line default
        #line hidden
        
        #line 219 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(colValue));

        
        #line default
        #line hidden
        
        #line 219 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(colNr < columns.Count()) {
        
        #line default
        #line hidden
        
        #line 219 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(", ");

        
        #line default
        #line hidden
        
        #line 219 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 } 
        
        #line default
        #line hidden
        
        #line 220 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	}
    PopIndent();
	WriteLine("");
 
        
        #line default
        #line hidden
        
        #line 223 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tWhere [");

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.SchemaName));

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.TableName));

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] = ");

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(pkeyValue));

        
        #line default
        #line hidden
        
        #line 224 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\r\n");

        
        #line default
        #line hidden
        
        #line 225 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 }
} 
        
        #line default
        #line hidden
        
        #line 227 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
protected void WriteInsertStatement(StorageEntitySetting table, string pkeyValue)
{
	int varCount = 4;
	var columns = table.UseInheritance ?
			table.Properties.Where(c => c.PrimaryKey == false & c.Exclude == false) :
			table.GetColumnList().Where(c => c.PrimaryKey == false & c.Exclude == false);
 
        
        #line default
        #line hidden
        
        #line 234 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tInsert Into [");

        
        #line default
        #line hidden
        
        #line 235 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.SchemaName));

        
        #line default
        #line hidden
        
        #line 235 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 235 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.TableName));

        
        #line default
        #line hidden
        
        #line 235 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("](\r\n");

        
        #line default
        #line hidden
        
        #line 236 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
	PushIndent("            ");
	if(!string.IsNullOrEmpty(pkeyValue)){ 
        
        #line default
        #line hidden
        
        #line 238 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("[");

        
        #line default
        #line hidden
        
        #line 238 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 238 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("], ");

        
        #line default
        #line hidden
        
        #line 238 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 } 
        
        #line default
        #line hidden
        
        #line 239 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	
	int colNr = 0;
	foreach (var column in columns)
	{ 
		if(colNr != 0 & (colNr % varCount == 0)) { WriteLine(""); } 
		colNr++;
		
        
        #line default
        #line hidden
        
        #line 245 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("[");

        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));

        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]");

        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(colNr < columns.Count()) {
        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(", ");

        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  } else { 
        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(")");

        
        #line default
        #line hidden
        
        #line 246 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  } 
        
        #line default
        #line hidden
        
        #line 247 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	}
    PopIndent();
	WriteLine("");
 
        
        #line default
        #line hidden
        
        #line 250 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tValues (");

        
        #line default
        #line hidden
        
        #line 251 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(!string.IsNullOrEmpty(pkeyValue)){ 
        
        #line default
        #line hidden
        
        #line 251 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(pkeyValue));

        
        #line default
        #line hidden
        
        #line 251 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(", ");

        
        #line default
        #line hidden
        
        #line 251 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 } 
        
        #line default
        #line hidden
        
        #line 252 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	colNr = 0;
	PushIndent("            ");
	foreach (var column in columns)
	{ 
		if(colNr != 0 & (colNr % varCount == 0)) { WriteLine(""); } 
		colNr++;
		string colValue = string.IsNullOrEmpty(column.InsertDefault) ? "@" + column.Name : column.InsertDefault; 
        
        #line default
        #line hidden
        
        #line 259 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(colValue));

        
        #line default
        #line hidden
        
        #line 259 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(colNr < columns.Count()) {
        
        #line default
        #line hidden
        
        #line 259 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(", ");

        
        #line default
        #line hidden
        
        #line 259 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  } else { 
        
        #line default
        #line hidden
        
        #line 259 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(")");

        
        #line default
        #line hidden
        
        #line 259 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
  } 
        
        #line default
        #line hidden
        
        #line 260 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	}
    PopIndent();
	WriteLine("");
 
        
        #line default
        #line hidden
        
        #line 264 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
} 
        
        #line default
        #line hidden
        
        #line 266 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
protected void WriteSelectStatement(string keyValue)
{
	var firstBase = TableDefinition.GetFirstBase();
 
        
        #line default
        #line hidden
        
        #line 270 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tSelect  [");

        
        #line default
        #line hidden
        
        #line 271 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.TableName));

        
        #line default
        #line hidden
        
        #line 271 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 271 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 271 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("],\r\n");

        
        #line default
        #line hidden
        
        #line 272 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 WriteSelectColumns(TableDefinition, TableDefinition.UseInheritance); 
        
        #line default
        #line hidden
        
        #line 273 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(TableDefinition.UseInheritance)
	{
		//TODO: Handle more than one inherited base
		WriteSelectColumns(firstBase); 
	} 
        
        #line default
        #line hidden
        
        #line 278 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 //TODO: Handle more than one inherited base
	if(TableDefinition.UseInheritance)
	{ 
        
        #line default
        #line hidden
        
        #line 280 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tFrom  [");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.SchemaName));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.TableName));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] Inner Join [");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] On [");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.TableName));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] = [");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 281 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]\r\n");

        
        #line default
        #line hidden
        
        #line 282 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} else { 
        
        #line default
        #line hidden
        
        #line 282 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tFrom  [");

        
        #line default
        #line hidden
        
        #line 283 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.SchemaName));

        
        #line default
        #line hidden
        
        #line 283 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 283 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(TableDefinition.TableName));

        
        #line default
        #line hidden
        
        #line 283 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]\r\n");

        
        #line default
        #line hidden
        
        #line 284 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	} 
        
        #line default
        #line hidden
        
        #line 284 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\tWhere [");

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.SchemaName));

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.TableName));

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(firstBase.PrimaryKeyColumn.Name));

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("] = ");

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(keyValue));

        
        #line default
        #line hidden
        
        #line 285 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("\r\n");

        
        #line default
        #line hidden
        
        #line 286 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
} 
        
        #line default
        #line hidden
        
        #line 288 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"

protected void WriteSelectColumns(StorageEntitySetting table, bool hasMore = false)
{	
	var columns = table.UseInheritance ?
			table.Properties.Where(c => c.PrimaryKey == false & c.Exclude == false) :
			table.GetColumnList().Where(c => c.PrimaryKey == false & c.Exclude == false);
	int colNr = 0;
	foreach (var column in columns)
	{
		colNr++; 
        
        #line default
        #line hidden
        
        #line 297 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("            [");

        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(table.TableName));

        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("].[");

        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));

        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write("]");

        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 if(colNr < columns.Count() | hasMore) {
        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(",");

        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 } 
        
        #line default
        #line hidden
        
        #line 298 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
this.Write(" \r\n");

        
        #line default
        #line hidden
        
        #line 299 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
	}

        
        #line default
        #line hidden
        
        #line 301 "F:\OzzCodeGen\OzzCodeGen\CodeEngines\Storage\Templates\MsSql\TsqlStoredProcs.tt"
 
} 
        
        #line default
        #line hidden
    }
    
    #line default
    #line hidden
}
