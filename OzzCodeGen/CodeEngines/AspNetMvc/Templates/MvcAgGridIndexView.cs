// ------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version: 17.0.0.0
//  
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace OzzCodeGen.CodeEngines.AspNetMvc.Templates
{
    using System.Linq;
    using System.Text;
    using System.Collections.Generic;
    using OzzCodeGen.Templates;
    using OzzCodeGen.Templates.Cs;
    using OzzCodeGen.Definitions;
    using OzzUtils;
    using System;
    
    /// <summary>
    /// Class to produce the template output
    /// </summary>
    
    #line 1 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "17.0.0.0")]
    public partial class MvcAgGridIndexView : AbstracMvcIndexView
    {
#line hidden
        /// <summary>
        /// Create the template output
        /// </summary>
        public override string TransformText()
        {
            
            #line 10 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 
bool searchable = Entity.DisplayColumns.Where(e => e.UseInSearch).Any();
var properties = Entity.DisplayColumns.Where(e => e.InIndexView);
var collectionProperties = Entity.GetInheritedCollectionProperties();
var entitiesThisForCreate = Entity.GetEntitiesStrongForThis();
var gridId = Entity.Name.ToCamelCase() + "Grid";

var pkeyProperty = Entity.GetPrimaryKey();
string pKey = pkeyProperty == null ? "Id" : pkeyProperty.Name;

WriteUsingNamespaces(); 
            
            #line default
            #line hidden
            this.Write("@model IEnumerable<");
            
            #line 21 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.Name));
            
            #line default
            #line hidden
            this.Write(">\r\n\r\n@{\r\n    ViewBag.Title = @");
            
            #line 24 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(EntityResource));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 24 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.Name.Pluralize()));
            
            #line default
            #line hidden
            this.Write(@";

    //Authorization Flags
    bool isUserAdmin = ViewBag.isUserAdmin ?? false;
    bool canUserEdit = ViewBag.canUserEdit ?? false;
    bool canUserCreate = ViewBag.canUserCreate ?? false;
    bool canUserDelete = ViewBag.canUserDelete ?? false;
    bool canSeeRestricted = ViewBag.canSeeRestricted ?? false;

    var title = ");
            
            #line 33 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(EntityResource));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 33 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.Name.Pluralize()));
            
            #line default
            #line hidden
            this.Write(";\r\n}\r\n<div class=\"well hidden-print\">\r\n    <div class=\"row\">\r\n        <div class=" +
                    "\"col-md-6 col-sm-5\">\r\n            <h4>@title</h4>\r\n        </div>\r\n");
            
            #line 40 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(Entity.CreatePartialView) { 
            
            #line default
            #line hidden
            this.Write("        <div class=\"col-sm-2\">\r\n            @if (canUserCreate)\r\n            {\r\n " +
                    "               @Html.ActionLink(ActionStrings.AddNew, \"Create\", null, new { @cla" +
                    "ss = \"btn btn-primary\", input_modal = ");
            
            #line 44 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(EntityResource));
            
            #line default
            #line hidden
            this.Write(".AddNew");
            
            #line 44 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.Name));
            
            #line default
            #line hidden
            this.Write(" })\r\n            }\r\n        </div>\r\n");
            
            #line 47 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  } 
            
            #line default
            #line hidden
            
            #line 48 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(searchable)
    { 
            
            #line default
            #line hidden
            this.Write("            <div class=\"col-md-4 col-sm-5\">\r\n                @Html.Partial(\"_Sear" +
                    "chBoxPartial\")\r\n            </div>\r\n");
            
            #line 53 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  } 
            
            #line default
            #line hidden
            this.Write("    </div>\r\n</div>\r\n<div id=\"mainGrid\" class=\"ag-style ag-basic\" style=\"width:100" +
                    "%;height:580px;\"></div>\r\n<nav><ul id=\"pagerUl\" class=\"pagination\"></ul></nav>\r\n@" +
                    "Html.Partial(\"_MessageBoxPartial\")\r\n@section scripts{\r\n");
            
            #line 60 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(HasModalInputForm) { 
            
            #line default
            #line hidden
            this.Write("    @Scripts.Render(\"~/bundles/jqueryval\")\r\n");
            
            #line 62 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  } 
            
            #line default
            #line hidden
            this.Write("    @Scripts.Render(\"~/js/ag-grid\")\r\n    @Html.Partial(\"_IndexScriptsPartial\", \"");
            
            #line 64 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.ControllerName));
            
            #line default
            #line hidden
            this.Write(@""") @* Controller's name *@
    <script type=""text/javascript"">
        var result = @Html.Raw(ViewBag.result);
        var gridOptions;

        var initPage = function() {
            let init = this;
            init.columnDefs = columnDefs();
            init.gridOptions = {
                columnDefs: init.columnDefs,
                rowHeight: 26,
                pageSize: result.pageSize,
                headerHeight: 32,
                rowData: result.Items,
                overlayNoRowsTemplate: '<span class=""fontSize150pc"">@MessageStrings.NoResults</span>'
            };

            function columnDefs(){
                return[
                     { headerName: '@ActionStrings.Action', field: """);
            
            #line 83 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(pKey));
            
            #line default
            #line hidden
            this.Write("\", width: 64, cellRenderer: actionCellRenderer},\r\n");
            
            #line 84 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 foreach (var property in properties) { 
            
            #line default
            #line hidden
            this.Write("                     { headerName: \'@Html.DisplayNameFor(m => m.");
            
            #line 85 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(property.Name));
            
            #line default
            #line hidden
            this.Write(")\', field: \"");
            
            #line 85 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(property.Name));
            
            #line default
            #line hidden
            this.Write("\", width: 180 },\r\n");
            
            #line 86 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write(@"                ];
            }

            function actionCellRenderer(params) {
                let actions = '<div class=""btn-group"" style=""margin-top:-3px;"">' +
                    '<button type=""button"" title=""@ActionStrings.Action"" class=""btn btn-xs btn-primary dropdown-toggle"" data-toggle=""dropdown"" onclick=""onActionMenuClick(this)"">' +
                    '<span class=""glyphicon glyphicon-tasks""></span> <span class=""caret""></span>' +
                    '</button>' +
                    '<ul class=""dropdown-menu mb15"" role=""menu"">' +
                    '<li><a href=""@Url.Action(""Details"")/' + params.value + '""");
            
            #line 96 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(Entity.DetailsPartialView) { 
            
            #line default
            #line hidden
            this.Write(" input-modal=\"@ActionStrings.Details\" ");
            
            #line 96 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write(">@ActionStrings.Details</a></li>\' +\r\n                @if (canUserEdit)\r\n         " +
                    "       {\r\n                    @:\'<li><a href=\"@Url.Action(\"Edit\")/\' + params.val" +
                    "ue + \'\"");
            
            #line 99 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(Entity.EditPartialView) { 
            
            #line default
            #line hidden
            this.Write(" input-modal=\"@ActionStrings.Edit\" ");
            
            #line 99 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write(">@ActionStrings.Edit</a></li>\' +\r\n                }\r\n                @if(canUserD" +
                    "elete)\r\n                {\r\n                    @:\'<li><a href=\"#deleteConfirm\" d" +
                    "ata-toggle=\"modal\" onclick=\"setDelete(getObjectById(result.Items,\' + params.valu" +
                    "e + \').");
            
            #line 103 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(DisplayMember));
            
            #line default
            #line hidden
            this.Write(", \' + params.value + \');\">@ActionStrings.Delete</a></li>\' +\r\n                }\r\n");
            
            #line 105 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if (entitiesThisForCreate.Any()) 
    { 
            
            #line default
            #line hidden
            this.Write("                    \'<li class=\"divider\"></li>\' +\r\n");
            
            #line 108 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
        foreach (var entity in entitiesThisForCreate)
        {
            
            #line default
            #line hidden
            this.Write("                @if (canUserCreate)\r\n                {\r\n                    @:\'<l" +
                    "i><a href=\"/");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.ControllerName));
            
            #line default
            #line hidden
            this.Write("/Create/?");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.StrongDependedForeignKey.ToCamelCase()));
            
            #line default
            #line hidden
            this.Write("=\' + params.value + \'\"");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(Entity.CreatePartialView) { 
            
            #line default
            #line hidden
            this.Write(" input-modal=\"@");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(EntityResource));
            
            #line default
            #line hidden
            this.Write(".Add");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Name));
            
            #line default
            #line hidden
            this.Write("\" ");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write(">@");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(EntityResource));
            
            #line default
            #line hidden
            this.Write(".Add");
            
            #line 112 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Name));
            
            #line default
            #line hidden
            this.Write("</a></li>\' +\r\n                }\r\n                    \'<li><a href=\"/");
            
            #line 114 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.ControllerName));
            
            #line default
            #line hidden
            this.Write("/Index/?");
            
            #line 114 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.StrongDependedForeignKey.ToCamelCase()));
            
            #line default
            #line hidden
            this.Write("=\' + params.value + \'\">@");
            
            #line 114 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(EntityResource));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 114 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Name.Pluralize()));
            
            #line default
            #line hidden
            this.Write("</a></li>\' +\r\n");
            
            #line 115 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
        } 
            
            #line default
            #line hidden
            
            #line 116 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  } 
            
            #line default
            #line hidden
            this.Write(@"                    '</ul></div>';

                return actions;
            }

            function boolCellRenderer(params) {
                if(params.value){
                    return '<span style=""font-size:16px;"" class=""glyphicon glyphicon-check text-success""></span>';
                }
                else{
                    return '<span style=""font-size:16px;"" class=""glyphicon glyphicon-unchecked text-danger""></span>';
                }
            }

            $.ajaxSetup({ cache: false });
            gridOptions = init.gridOptions;
            // angularGrid is a global function
            agGridGlobalFunc('#mainGrid', gridOptions);

            setPagerButtons($('#pagerUl'), result.Page, result.PageCount);
            displayRecordStats(result.Items.length, result.TotalCount);
");
            
            #line 138 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(HasModalPartialForm) { 
            
            #line default
            #line hidden
            this.Write("            setActionLinks();\r\n");
            
            #line 140 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write("        }\r\n\r\n        function refreshData() {\r\n            getPagedData(result.Pa" +
                    "ge);\r\n        }\r\n\r\n        function getPagedData(page) {\r\n            let search" +
                    "String = $(\'#SearchString\').val();\r\n            let url = \"/");
            
            #line 149 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.ControllerName));
            
            #line default
            #line hidden
            this.Write("/Get");
            
            #line 149 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(Entity.Name));
            
            #line default
            #line hidden
            this.Write(@"PagedList"";
            showBusy();
            $.getJSON(url, {
                pageSize: result.PageSize,
                page: page,
                searchString: searchString,
                postBack: true,
                cache: false
            },
                function (data) {
                    result = data;
                    hideBusy();
                    gridOptions.api.setRowData(result.Items);
                    setPagerButtons($('#pagerUl'), result.Page, result.PageCount);
                    displayRecordStats(result.Items.length, result.TotalCount);
");
            
            #line 164 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(HasModalPartialForm) { 
            
            #line default
            #line hidden
            this.Write("                    setActionLinks();\r\n");
            
            #line 166 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write(@"                }).fail(function (jqXHR, textStatus, errorThrown) {
                    hideBusy();
                    let msgboxMsg = jqXHR.responseText;
                    showMessageBox(textStatus, msgboxMsg, true);
                }).always(function (jqXHR) {

                });
        }
");
            
            #line 175 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
  if(HasModalPartialForm) { 
            
            #line default
            #line hidden
            this.Write(@"        function setActionLinks(){
            $('a[input-modal]').on('click', function (params) {
                if (params.ctrlKey || params.metaKey || params.altKey) {
                    return true;
                }
                showBusy();
                let title = $(this).attr(""input-modal"");
                let url = this.href;
                url += (url.indexOf('?') == -1) ? '?' : '&';
                url += 'modal=true';
                $('#dataInputBody').load(url, function () {
                    hideBusy();
                    if (title != null || title != '') {
                        $('#dataInputTitle').html(title);
                    }
                    let inputForm = document.getElementById('dataInputForm');
                    if (inputForm != null) {
                        $('#dataInputFooter').show();
                    }
                    else {
                        $('#dataInputFooter').hide();
                    }
                    $('#dataInputModal').modal('show');
                });
                return false;
            });
        }
");
            
            #line 203 "C:\Users\ozalp\source\repos\OzzCodeGen\OzzCodeGen\CodeEngines\AspNetMvc\Templates\MvcAgGridIndexView.tt"
 } 
            
            #line default
            #line hidden
            this.Write(@"
        function onActionMenuClick(menuBtn){
            setTimeout(function(){
                let menuHeight = 220;
                let rectMenu = menuBtn.getBoundingClientRect();
                let rectGrid = document.getElementById(""mainGrid"").getBoundingClientRect();

                let diffY = rectGrid.bottom - rectMenu.bottom - menuHeight;
                if (diffY < 0) {
                    let viewport = $('#mainGrid .ag-body-viewport');
                    let viewportScroll = viewport.scrollTop();
                    viewport.scrollTop((diffY * -1) + viewportScroll);
                }
            },250);
        }
        document.addEventListener(""DOMContentLoaded"", initPage());
    </script>
}");
            return this.GenerationEnvironment.ToString();
        }
    }
    
    #line default
    #line hidden
}
